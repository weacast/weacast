<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Probe plugin | Weacast</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="https://s3.eu-central-1.amazonaws.com/kalisioscope/weacast/weacast-icon-64x64.png">
    <link rel="manifest" href="/weacast/manifest.json">
    <meta name="description" content="An Open Source platform to gather, expose and make use of weather forecast data">
    
    <link rel="preload" href="/weacast/assets/css/0.styles.a9f019ae.css" as="style"><link rel="preload" href="/weacast/assets/js/app.ac060bd1.js" as="script"><link rel="preload" href="/weacast/assets/js/3.b15629dc.js" as="script"><link rel="preload" href="/weacast/assets/js/11.222fb095.js" as="script"><link rel="preload" href="/weacast/assets/js/7.672f8327.js" as="script"><link rel="prefetch" href="/weacast/assets/js/10.0bd69f78.js"><link rel="prefetch" href="/weacast/assets/js/12.3d9f2c05.js"><link rel="prefetch" href="/weacast/assets/js/13.8d459d3e.js"><link rel="prefetch" href="/weacast/assets/js/14.ac0434c5.js"><link rel="prefetch" href="/weacast/assets/js/15.0ecd3040.js"><link rel="prefetch" href="/weacast/assets/js/16.35c50976.js"><link rel="prefetch" href="/weacast/assets/js/17.46c51dc9.js"><link rel="prefetch" href="/weacast/assets/js/18.507afa88.js"><link rel="prefetch" href="/weacast/assets/js/19.cdca6a83.js"><link rel="prefetch" href="/weacast/assets/js/2.cb793405.js"><link rel="prefetch" href="/weacast/assets/js/20.da810556.js"><link rel="prefetch" href="/weacast/assets/js/21.826d11b5.js"><link rel="prefetch" href="/weacast/assets/js/22.6e76a2df.js"><link rel="prefetch" href="/weacast/assets/js/23.29521f1b.js"><link rel="prefetch" href="/weacast/assets/js/24.be326c0b.js"><link rel="prefetch" href="/weacast/assets/js/25.4afed87e.js"><link rel="prefetch" href="/weacast/assets/js/26.4dda818c.js"><link rel="prefetch" href="/weacast/assets/js/27.fa76a0ed.js"><link rel="prefetch" href="/weacast/assets/js/28.e6136d9a.js"><link rel="prefetch" href="/weacast/assets/js/29.55793532.js"><link rel="prefetch" href="/weacast/assets/js/30.392a95cb.js"><link rel="prefetch" href="/weacast/assets/js/31.b19573bb.js"><link rel="prefetch" href="/weacast/assets/js/32.d0c09c6f.js"><link rel="prefetch" href="/weacast/assets/js/33.b2ac416b.js"><link rel="prefetch" href="/weacast/assets/js/34.8a18087e.js"><link rel="prefetch" href="/weacast/assets/js/35.114b641e.js"><link rel="prefetch" href="/weacast/assets/js/36.095dbb6c.js"><link rel="prefetch" href="/weacast/assets/js/37.ef2c247e.js"><link rel="prefetch" href="/weacast/assets/js/38.4ffe1c7b.js"><link rel="prefetch" href="/weacast/assets/js/39.8ebd1583.js"><link rel="prefetch" href="/weacast/assets/js/4.5a12e330.js"><link rel="prefetch" href="/weacast/assets/js/40.07495c10.js"><link rel="prefetch" href="/weacast/assets/js/41.ccbb3579.js"><link rel="prefetch" href="/weacast/assets/js/42.bff72d9a.js"><link rel="prefetch" href="/weacast/assets/js/5.96f31a56.js"><link rel="prefetch" href="/weacast/assets/js/6.986ec23e.js"><link rel="prefetch" href="/weacast/assets/js/8.38b6ea1d.js"><link rel="prefetch" href="/weacast/assets/js/9.e56c8433.js">
    <link rel="stylesheet" href="/weacast/assets/css/0.styles.a9f019ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/weacast/" class="home-link router-link-active"><!----> <span class="site-name">Weacast</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/weacast/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/weacast/guides/" class="nav-link">
  Guides
</a></div><div class="nav-item"><a href="/weacast/architecture/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/weacast/api/" class="nav-link router-link-active">
  API
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/weacast/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/weacast/guides/" class="nav-link">
  Guides
</a></div><div class="nav-item"><a href="/weacast/architecture/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/weacast/api/" class="nav-link router-link-active">
  API
</a></div> <!----></nav> <p align="center"><a href="https://kalisio.com"><img src="https://s3.eu-central-1.amazonaws.com/kalisioscope/kalisio/kalisio-logo-black-256x84.png"></a> <br> <!----></p> <ul class="sidebar-links"><li><a href="/weacast/api/" aria-current="page" class="sidebar-link">API</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Core</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Plugins</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/weacast/api/plugin.html" class="sidebar-link">Forecast model plugins</a></li><li><a href="/weacast/api/loader.html" class="sidebar-link">Forecast data loaders</a></li><li><a href="/weacast/api/probe.html" aria-current="page" class="active sidebar-link">Probe plugin</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/weacast/api/probe.html#direction-elements" class="sidebar-link">Direction elements</a></li><li class="sidebar-sub-header"><a href="/weacast/api/probe.html#probes-api" class="sidebar-link">Probes API</a></li><li class="sidebar-sub-header"><a href="/weacast/api/probe.html#probe-hooks" class="sidebar-link">Probe hooks</a></li><li class="sidebar-sub-header"><a href="/weacast/api/probe.html#probe-results-api" class="sidebar-link">Probe results API</a></li><li class="sidebar-sub-header"><a href="/weacast/api/probe.html#probe-results-hooks" class="sidebar-link">Probe results hooks</a></li></ul></li><li><a href="/weacast/api/alert.html" class="sidebar-link">Alert plugin</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Client</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="probe-plugin"><a href="#probe-plugin" class="header-anchor">#</a> <a href="https://github.com/weacast/weacast/packages/probe" target="_blank" rel="noopener noreferrer">Probe plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h1> <p>Probes are virtual sensors used to derive your own business focused data by probing forecast data at specific locations of interest (e.g. airports, cities, stores, etc.). This plugin manages two kind of probes:</p> <ul><li><strong>on-demand probing</strong>, which allow to compute <em>on-demand</em> (e.g. by a request to the server) forecast element values for a given forecast time and a set of locations,</li> <li><strong>probing stream</strong>, which allow to make the Weacast server automatically and continuously compute forecast element values for a set of locations as new forecast data are gathered and then retrieve results <em>on-demand</em> (e.g. by a request to the server).</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Probed values are computed using <a href="/weacast/api/grid.html#interpolatelongitude-latitude">interpolation</a> of the forecast data.</p></div> <p>On-demand probing is limited to a <strong>small number of locations</strong> (typically several hundreds) because results are directly returned in the request response. When you have a <strong>large number of locations</strong> (typically thousands) you have to use probing streams. Indeed, it allows to paginate and filter the probe results according to various parameters such as spatial locations, forecast times, element values, etc. thus limiting the size of the data to be managed.</p> <blockquote><p>For now probes can only be specified using the <a href="https://en.wikipedia.org/wiki/World_Geodetic_System" target="_blank" rel="noopener noreferrer">WGS 84 longitude-latitude CRS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="direction-elements"><a href="#direction-elements" class="header-anchor">#</a> Direction elements</h2> <p>Forecast elements can be scalar value or axis component of vector value. This plugin can manage direction elements such as <a href="http://colaweb.gmu.edu/dev/clim301/lectures/wind/wind-uv.html" target="_blank" rel="noopener noreferrer">wind direction<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and compute for you the derived speed (vector norm) and direction (in degrees measured from the north) from the individual axis components.</p> <p>If an element name starts with a <code>u-</code> or (respectively <code>v-</code>) prefix it is assumed to be the u-axis (respectively v-axis) component of the direction named according to the element name suffix. As a consequence if you probe elements <code>u-wind</code> and <code>v-wind</code> the plugin will generate a derived <code>windDirection</code> and <code>windSpeed</code> value for each of your locations.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Weacast specifies the <a href="http://mst.nerc.ac.uk/wind_vect_convs.html" target="_blank" rel="noopener noreferrer">meteorological wind direction<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (in degrees), i.e. the direction <strong>from</strong> which the wind is blowing. The speed is provided with the same unit as the underlying forecast model (usually in SI unit <code>m/s</code>).</p></div> <h3 id="relative-directions"><a href="#relative-directions" class="header-anchor">#</a> Relative directions</h3> <p>It is often useful to get the direction of an element (e.g. wind) relatively to a given local orientation (e.g. the direction of runway in an airport). In this case Weacast can compute for you the relative direction of the element with respect to the orientation of your locations, assuming they have an attribute defining it as a <a href="http://mst.nerc.ac.uk/wind_vect_convs.html" target="_blank" rel="noopener noreferrer">bearing or azimuth<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in degrees. As a consequence if you probe elements <code>u-wind</code> and <code>v-wind</code> the plugin will generate a derived <code>windBearingDirection</code> value storing the relative direction of the wind w.r.t. your local orientation for each of your locations.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Weacast specifies the <a href="http://mst.nerc.ac.uk/wind_vect_convs.html" target="_blank" rel="noopener noreferrer">relative wind vector azimuth<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (in degrees), i.e. the direction <strong>towards</strong> which the wind is blowing w.r.t. the local orientation.</p></div> <h2 id="probes-api"><a href="#probes-api" class="header-anchor">#</a> Probes API</h2> <blockquote><p>On the client/server side the API is exposed using the <a href="https://docs.feathersjs.com/api/client.html#universal-isomorphic-api" target="_blank" rel="noopener noreferrer">Feathers isomorphic API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and the <a href="https://docs.feathersjs.com/api/databases/querying.html" target="_blank" rel="noopener noreferrer">Feathers common database query API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>The plugin exposes the available probes through the <code>probes</code> service. Although only web sockets are usually used on the client side, both the <a href="https://docs.feathersjs.com/api/rest.html" target="_blank" rel="noopener noreferrer">REST<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and the <a href="https://docs.feathersjs.com/api/socketio.html" target="_blank" rel="noopener noreferrer">Socket<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> interfaces are configured.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>update</code>, <code>patch</code> methods are not allowed on probes for now, you will have to recreate a probe to update it.</p></div> <h3 id="data-model"><a href="#data-model" class="header-anchor">#</a> Data model</h3> <p>The common data model of a probe as used by the API is <a href="/weacast/architecture/data-model-view.html#probe-data-model">detailed here</a>.</p> <h3 id="create-probes"><a href="#create-probes" class="header-anchor">#</a> Create probes</h3> <p>Creating on-demand or streamed probes is pretty similar, you have to provide a GeoJSON feature collection and indicates which forecast model instance and element values you'd like to probe in your forecast data, e.g. for on-demand probing:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> api <span class="token keyword">from</span> <span class="token string">'src/api'</span>

api<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token string">'probes'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
<span class="token punctuation">{</span>
  <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;FeatureCollection&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;forecast&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arpege-europe&quot;</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;elements&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;u-wind&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v-wind&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;features&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;geometry&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;coordinates&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">144.29091388888889</span><span class="token punctuation">,</span>
          <span class="token operator">-</span><span class="token number">5.823011111111111</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">forecastTime</span><span class="token operator">:</span> <span class="token string">'2017-05-24T12:00:00.000Z'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do something with the probed values</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Response:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;FeatureCollection&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;forecast&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arpege-europe&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;elements&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;u-wind&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v-wind&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;features&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;u-wind&quot;</span><span class="token operator">:</span> <span class="token number">-12.5152110987149</span><span class="token punctuation">,</span>
        <span class="token property">&quot;v-wind&quot;</span><span class="token operator">:</span> <span class="token number">-1.62322067440722</span><span class="token punctuation">,</span>
        <span class="token property">&quot;windDirection&quot;</span><span class="token operator">:</span> <span class="token number">82.6100015193614</span><span class="token punctuation">,</span>
        <span class="token property">&quot;windSpeed&quot;</span><span class="token operator">:</span> <span class="token number">12.6200378051423</span>
      <span class="token punctuation">}</span>
      <span class="token property">&quot;geometry&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;coordinates&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">144.29091388888889</span><span class="token punctuation">,</span>
          <span class="token number">-5.823011111111111</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The forecast time can also be a range to be specified using comparison operators, e.g.:</p> <div class="language- extra-class"><pre class="language-text"><code>query: {
  forecastTime: {
    $gte: '2017-05-24T12:00:00.000Z',
    $lte: '2017-05-25T12:00:00.000Z'
  }
}
</code></pre></div><p>In this case the feature probed value, runTime and forecastTime will be arrays ordered by ascending time and stored in an additional property per probed element according to its <a href="/weacast/guides/basics.html#configuring">configured name</a></p> <blockquote><p>Take care that querying a large range of forecast is a time and memory consuming operation. If you'd like to leverage performance you should enable <a href="https://github.com/perliedman/tiled-maps" target="_blank" rel="noopener noreferrer">tiling<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in <a href="/weacast/guides/basics.html#configuring">configuration</a> and only request data at a specific location using a <a href="https://docs.mongodb.com/manual/reference/operator/query-geospatial/" target="_blank" rel="noopener noreferrer">geospatial query<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> like this (in this case you do not need to provide GeoJSON features as input):</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>api.getService('probes').create(
{
  &quot;forecast&quot;: &quot;arpege-europe&quot;,
  &quot;elements&quot;: [&quot;u-wind&quot;, &quot;v-wind&quot;],
},
{
  query: {
    forecastTime: {
      $gte: '2017-05-24T12:00:00.000Z',
      $lte: '2017-05-25T12:00:00.000Z'
    },
    geometry: {
      $geoIntersects: {
        $geometry: {
          type: 'Point',
          coordinates: [ long, lat ]
        }
      }
    }
  }
})
</code></pre></div><p>A streamed probe is automatically created if you do not provide the <code>forecastTime</code> in the query, you then have to use the <a href="/weacast/api/probe.html#probe-results">probe results API</a> to retrieve element values.</p> <h3 id="available-probes"><a href="#available-probes" class="header-anchor">#</a> Available probes</h3> <p>For example you can request the available probes like this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> api <span class="token keyword">from</span> <span class="token string">'src/api'</span>

api<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token string">'probes'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do something with the probe data</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Response:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;total&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token property">&quot;limit&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token property">&quot;skip&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;59248de38bb91d28d8155b37&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;FeatureCollection&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;forecast&quot;</span><span class="token operator">:</span> <span class="token string">&quot;arpege-world&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;elements&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;u-wind&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;v-wind&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;gust&quot;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ...
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="property-selection"><a href="#property-selection" class="header-anchor">#</a> Property selection</h3> <p>You can skip pagination and retrieve selected properties only:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> api <span class="token keyword">from</span> <span class="token string">'src/api'</span>

api<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token string">'probes'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">$paginate</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token literal-property property">$select</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'elements'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do something with the element data</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Response:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;59248de38bb91d28d8155b37&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;elements&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;u-wind&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;v-wind&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;gust&quot;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">]</span>
</code></pre></div><h3 id="features-retrieval"><a href="#features-retrieval" class="header-anchor">#</a> Features retrieval</h3> <p>To retrieve features for a given probe you have to request it explicitly:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> api <span class="token keyword">from</span> <span class="token string">'src/api'</span>

api<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token string">'probes'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>probeId<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">$select</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'features'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do something with the features</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Response:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;features&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        ...
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;geometry&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;coordinates&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">75.95707224036518</span><span class="token punctuation">,</span>
          <span class="token number">30.850359856170176</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ...
<span class="token punctuation">}</span>
</code></pre></div><h2 id="probe-hooks"><a href="#probe-hooks" class="header-anchor">#</a> Probe hooks</h2> <p>The following hooks are executed on the Probe service:
<img src="/weacast/assets/img/probe-hooks.b36dde04.svg" alt="Probe hooks"></p> <p>Some additional hooks are provided by the Probe plugin.</p> <h3 id="marshallresultquery-hook-source"><a href="#marshallresultquery-hook-source" class="header-anchor">#</a> .marshallResultQuery(hook) <a href="https://github.com/weacast/weacast/packages/probe/blob/master/src/hooks/probing.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Filter results to match the given probe object ID as query parameter.</p> <h3 id="checkprobingtype-hook-source"><a href="#checkprobingtype-hook-source" class="header-anchor">#</a> .checkProbingType(hook) <a href="https://github.com/weacast/weacast/packages/probe/blob/master/src/hooks/probing.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Check if the created probe in a on-demand or a streamed probe. In the first case it will avoid creating the probe object in the database as probed values are computed on-the-fly.</p> <h3 id="performprobing-hook-source"><a href="#performprobing-hook-source" class="header-anchor">#</a> .performProbing(hook) <a href="https://github.com/weacast/weacast/packages/probe/blob/master/src/hooks/probing.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Perform the probing operation, i.e. compute probed values from forecast data of each available forecast time (streamed probe) or for the given forecast time as query parameter (on-demand probe).</p> <h3 id="removeresults-hook-source"><a href="#removeresults-hook-source" class="header-anchor">#</a> .removeResults(hook) <a href="https://github.com/weacast/weacast/packages/probe/blob/master/src/hooks/probing.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Remove all results matching the input probe object when it is removed from the database (streamed probe only).</p> <h3 id="removefeatures-hook-source"><a href="#removefeatures-hook-source" class="header-anchor">#</a> .removeFeatures(hook) <a href="https://github.com/weacast/weacast/packages/probe/blob/master/src/hooks/probing.js" target="_blank" rel="noopener noreferrer">source<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h3> <p>Remove all features of the input probe object when not explicitly required (streamed probe only).</p> <h2 id="probe-results-api"><a href="#probe-results-api" class="header-anchor">#</a> Probe results API</h2> <p>Probe results are generated by probing streams.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>On the client/server side the API is exposed using the <a href="https://docs.feathersjs.com/api/client.html#universal-isomorphic-api" target="_blank" rel="noopener noreferrer">Feathers isomorphic API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and the <a href="https://docs.feathersjs.com/api/databases/querying.html" target="_blank" rel="noopener noreferrer">Feathers common database query API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <p>The plugin exposes the available probe results through the <code>probe-results</code> service. Although only web sockets are usually used on the client side, both the <a href="https://docs.feathersjs.com/api/rest.html" target="_blank" rel="noopener noreferrer">REST<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and the <a href="https://docs.feathersjs.com/api/socketio.html" target="_blank" rel="noopener noreferrer">Socket<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> interfaces are configured.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>create</code>, <code>update</code>, <code>patch</code>, <code>remove</code> methods are only allowed from the server side, clients can only <code>get</code>and <code>find</code> probe results.</p></div> <h3 id="data-model-2"><a href="#data-model-2" class="header-anchor">#</a> Data model</h3> <p>The common data model of probe results as used by the API is <a href="./../architecture/data-model-view#probe-result-data-model">detailed here</a>.</p> <blockquote><p>Probe results are usually numerous so you need to paginate/filter them</p></blockquote> <h3 id="available-probe-results"><a href="#available-probe-results" class="header-anchor">#</a> Available probe results</h3> <p>For example you can request the available probe results like this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> api <span class="token keyword">from</span> <span class="token string">'src/api'</span>

api<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token string">'probe-results'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">probeId</span><span class="token operator">:</span> <span class="token string">'59248de38bb91d28d8155b3c'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">forecastTime</span><span class="token operator">:</span> <span class="token string">'2017-05-24T12:00:00.000Z'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do something with the probe results</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Response:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;total&quot;</span><span class="token operator">:</span> <span class="token number">891</span><span class="token punctuation">,</span>
  <span class="token property">&quot;limit&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token property">&quot;skip&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;592490118bb91d28d815969b&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Feature&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;u-wind&quot;</span><span class="token operator">:</span> <span class="token number">-12.5152110987149</span><span class="token punctuation">,</span>
        <span class="token property">&quot;v-wind&quot;</span><span class="token operator">:</span> <span class="token number">-1.62322067440722</span><span class="token punctuation">,</span>
        <span class="token property">&quot;windDirection&quot;</span><span class="token operator">:</span> <span class="token number">82.6100015193614</span><span class="token punctuation">,</span>
        <span class="token property">&quot;windSpeed&quot;</span><span class="token operator">:</span> <span class="token number">12.6200378051423</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;geometry&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;coordinates&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token number">75.95707224036518</span><span class="token punctuation">,</span>
          <span class="token number">30.850359856170176</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;runTime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2017-05-24T06:00:00.000Z&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;forecastTime&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2017-05-24T12:00:00.000Z&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;probeId&quot;</span><span class="token operator">:</span> <span class="token string">&quot;59248de38bb91d28d8155b3c&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ...
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="advanced-probe-results-filtering"><a href="#advanced-probe-results-filtering" class="header-anchor">#</a> Advanced probe results filtering</h3> <p>Probe results are spatially indexed based on <a href="https://docs.mongodb.com/manual/applications/geospatial-indexes/" target="_blank" rel="noopener noreferrer">MongoDB capabilities<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. So you can perform a <a href="https://docs.mongodb.com/manual/reference/operator/query-geospatial/" target="_blank" rel="noopener noreferrer">geospatial query<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> on your results like this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> api <span class="token keyword">from</span> <span class="token string">'src/api'</span>

api<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token string">'probe-results'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">probeId</span><span class="token operator">:</span> <span class="token string">'59248de38bb91d28d8155b3c'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">$near</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">$geometry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'Point'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">coordinates</span><span class="token operator">:</span> <span class="token punctuation">[</span>longitude<span class="token punctuation">,</span> latitude<span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">$maxDistance</span><span class="token operator">:</span> <span class="token number">10000</span> <span class="token comment">// in meters, i.e. 10 Kms around</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do something with the probe results</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Such a complex query is fine when using the <a href="https://docs.feathersjs.com/api/client.html#universal-isomorphic-api" target="_blank" rel="noopener noreferrer">Feathers isomorphic API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> but if to be expressed manually as REST you have to convert nested objects to array notation like this: <code>/api/probe-results?probeId=59248de38bb91d28d8155b3c&amp;forecastTime=2017-05-27T07:00:00.000Z&amp;geometry[$near][$maxDistance]=1000000&amp;geometry[$near][$geometry][type]=Point&amp;geometry[$near][$geometry][coordinates][]=5&amp;geometry[$near][$geometry][coordinates][]=43</code>.</p> <p>You can also filter results according to the computed element values by using the <a href="https://docs.feathersjs.com/api/databases/querying.html" target="_blank" rel="noopener noreferrer">Feathers common database query API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, e.g. to get results with a wind speed between 2 m/s and 5 m/s:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> api <span class="token keyword">from</span> <span class="token string">'src/api'</span>

api<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token string">'probe-results'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">probeId</span><span class="token operator">:</span> <span class="token string">'59248de38bb91d28d8155b3c'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'properties.windSpeed'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">$gte</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token literal-property property">$lte</span><span class="token operator">:</span> <span class="token number">5</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do something with the probe results</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="probe-results-aggregation"><a href="#probe-results-aggregation" class="header-anchor">#</a> Probe results aggregation</h3> <p>Sometimes it is better to retrieve a single result aggregating all the requested forecast times for a given features instead of multiple single results (i.e. one per forecast time). You can perform such an aggregation based on <a href="https://docs.mongodb.com/manual/core/aggregation-pipeline/" target="_blank" rel="noopener noreferrer">MongoDB capabilities<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> like this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> api <span class="token keyword">from</span> <span class="token string">'src/api'</span>

api<span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token string">'probe-results'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">probeId</span><span class="token operator">:</span> <span class="token string">'59248de38bb91d28d8155b3c'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">forecastTime</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// Target time range</span>
      <span class="token literal-property property">$gte</span><span class="token operator">:</span> <span class="token string">'2017-05-24T12:00:00.000Z'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">$lte</span><span class="token operator">:</span> <span class="token string">'2017-05-25T12:00:00.000Z'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">$groupBy</span><span class="token operator">:</span> <span class="token string">'properties.iata_code'</span><span class="token punctuation">,</span> <span class="token comment">// Will perform aggregation based on this unique feature identifier</span>
    <span class="token string-property property">'properties.iata_code'</span><span class="token operator">:</span> <span class="token string">'LFBO'</span><span class="token punctuation">,</span> <span class="token comment">// The target feature to aggregate, if omit all will be</span>
    <span class="token literal-property property">$aggregate</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'windDirection'</span><span class="token punctuation">,</span> <span class="token string">'windSpeed'</span><span class="token punctuation">,</span> <span class="token string">'gust'</span><span class="token punctuation">]</span> <span class="token comment">// List of elements to aggregate over time</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do something with the probe results</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="probe-results-hooks"><a href="#probe-results-hooks" class="header-anchor">#</a> Probe results hooks</h2> <p>The following hooks are executed on the Probe results service:
<img src="/weacast/assets/img/probe-result-hooks.630d12f2.svg" alt="Probe results hooks"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/weacast/api/loader.html" class="prev">
        Forecast data loaders
      </a></span> <span class="next"><a href="/weacast/api/alert.html">
        Alert plugin
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/weacast/assets/js/app.ac060bd1.js" defer></script><script src="/weacast/assets/js/3.b15629dc.js" defer></script><script src="/weacast/assets/js/11.222fb095.js" defer></script><script src="/weacast/assets/js/7.672f8327.js" defer></script>
  </body>
</html>
